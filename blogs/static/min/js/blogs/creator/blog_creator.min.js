function getCookie(e){return document.cookie.split("; ").find(t=>t.startsWith(e)).split("=")[1]}function clientRequester(e,t){let n=new XMLHttpRequest;n.open(e.method,e.url);let o=[{name:"X-CSRFTOKEN",value:getCookie("csrftoken")}];if(e.header)for(let t of e.headers)o.push({name:t.name,value:t.value});for(let e of t)n.addEventListener(e.name,e.func);for(let e of o)n.setRequestHeader(e.name,e.value);try{n.send(e.body)}catch(e){console.log(e)}return n}!function(){var e={element:$(".loading-bar"),set:function(t,n){let o;o=t!==n?t*n/100+"%":"0%",e.element.width(o)}};var t={inputs:{imageFile:null,title:null,content:null},base64:async function(e){var t=await e.arrayBuffer();let n="";for(let e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return"data:"+e.type+";base64,"+window.btoa(n)},elements:{cover:()=>$("#image-cover"),uploadBtn:()=>$(".new-blog-cover .upload-cover-btn"),title:()=>$(".new-blog-title .title-input"),content:()=>$("#blog-content"),submitBtns:{save:()=>$(".submit-btns .post"),cancel:()=>$(".submit-btns .cancel")},coverContainer:()=>$(".new-blog-cover .cover")},init:function(){console.log("the Blog View is being initialized..."),t.elements.uploadBtn().on("click",function(e){e.preventDefault(),t.elements.cover().click()}),t.elements.cover().on("input",t.eventHandlers.coverUpload),t.elements.submitBtns.save().on("click",t.eventHandlers.postBlog)},eventHandlers:{coverUpload:async function(n){let o=n.currentTarget.files[0];o.fileName="bechr",console.log("file name: ",o);let l=new FileReader,a=new Image;a.style.width="100%",l.onprogress=function(t){let n=t.loaded,o=t.total;e.set(n,o)},l.onloadend=function(e){var n=e.target.result;a.src=n,t.inputs.imageFile=o},l.readAsDataURL(o),t.elements.coverContainer().html(a)},postBlog:function(e){t.post()}},checkCoverImage:function(e){e.width,e.height},post:function(){var n={title:t.elements.title().val(),content:t.elements.content().val(),file:t.inputs.imageFile},o=new FormData;o.append("imageFile",n.file),o.append("content",n.content),o.append("title",n.title);clientRequester({body:o,method:"POST",url:window.location.origin+"/blogs/post/"},[{name:"progress",func:function(t){if(t.lengthComputable){console.log("loading...");let n=t.loaded,o=t.total;e.set(n,o)}else e.set(100,100)}},{name:"loadstart",func:function(e){t.elements.submitBtns.save().attr("disabled","true")}},{name:"loadend",func:function(e){}},{name:"readystatechange",func:function(e){var t=e.target.response;console.log("Response = ",t);var n=JSON.parse(t);if(n.error)alert(n.error);else{console.log(n.message);let e=window.location.origin+"/me";window.location.replace(e)}}}])}};t.init()}();
