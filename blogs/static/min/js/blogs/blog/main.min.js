!function(){function e(e){return document.cookie.split("; ").find(t=>t.startsWith(e)).split("=")[1]}let t=document.getElementsByClassName("blog-img")[0],n=t.firstElementChild;t.onmousemove=function(e){let t=[n.clientHeight/2,n.clientWidth/2],o=t[1]-e.x,s=t[0]-e.y;n.clientWidth>e.x&&n.clientWidth>e.y&&(n.style.transform=`translate(${o}px,${s}px)`)},t.onmouseout=function(e){n.style.transform=""};let o={id:document.querySelector(".blog-container").id,comment_inputs_active:!1,models:{comment_loading:async function(e){var t=document.createElement("div");t.classList="comment-loading-container";for await(let n of function(e,t){let n=[];for(let o=e;o<=t;o++)n.push(o);return n}(0,e)){let e=$('<div class="comment-loading">\n                            <div class="user-img-loading">\n\n                            </div>\n                            <div class="content-loading">\n                                \n                            </div>\n                        </div>');t.appendChild(e[0])}return t},no_comments:$('<div class="comments-empty">\n                            <p><i class="fa fa-ellipsis-h" aria-hidden="true"></i></p>\n                            <span class="message">You can be the first how comments !</span>\n                        </div>'),comment:function(e){function t(){return e.isComment?`<div class="option reply"><span>Reply</span></div>\n                                    <div class="option reply show-replies"><span>Show ${e.replies_count} replies</span></div>`:""}let n=o.eventHandlers.resolveTags(e.content);var s=$(`<div class="comment">\n                            <div class="user_img">\n                                <img src="${e.user_img||""}" alt="">\n                            </div>\n                            <div class="comment_content">\n                                <div class="content">\n                                    <h5 class="username">${e.commented_by}</h5>\n                                        <span>${n}</span>\n                                </div>\n                                \n                                <div class="options">\n                                    <div class="option date"><span>${e.created_date}</span></div>\n                                    ${t()}\n                                </div>\n                            </div>\n                        </div>`);if(s[0]._id=e.id,console.log(e.id),s.find(".comment_content .username").on("click",function(t){window.location.href=window.location.origin+"/user/"+e.commented_by}),""!==t()){let t=s.find(".comment_content  .options .show-replies");t[0].addEventListener("click",function(n){n.comment_id=e.id,n.container=s,s.repliesShown?(s.find(" > .comment_content .comment").remove(),s.repliesShown=!1,t[0].innerText="Show "+e.replies_count+" replies"):o.eventHandlers.show_replies(n)}),s.find(".comment_content  .options .reply")[0].addEventListener("click",function(t){let n=o.models.comment_inputs({comment_id:e.id,container:s}),i=s.find(".comment_content");o.comment_inputs_active?(o.comment_inputs_active.remove(),o.comment_inputs_active=n):o.comment_inputs_active=n,i.after(n)})}return o.comments_list.push(e.pk),s},more_comments:function(){let e=$(' <div class="more-comments">\n                            <div class="more-comments-btn">\n                                <i class="fa fa-plus" aria-hidden="true"></i>\n                            </div>\n                        </div> ');return e.find(".more-comments-btn").on("click",o.eventHandlers.more_comments),e},comment_inputs:function(e){let t=$('<div class="comment-inputs">\n                            <textarea id="comment-reply" placeholder="Your comment here..."></textarea>\n                            <button class="cg-btn" id="comment-reply-btn"><i class="fas fa-paper-plane    "></i></button>\n                        </div>'),n=t.find("#comment-reply"),s=t.find("#comment-reply-btn");return s[0].content=n.val(),s.on("click",function(t){t._id=e.comment_id,t.content=n.val(),t.container=e.container,o.eventHandlers.reply(t)}),t},comments_count:$(".comments-container .list-comments .title h4 span ")},elements:{comments_body:()=>$(".comments-container .list-comments .body"),comment_input:()=>$("#comment-text"),comment_btn:()=>$("#comment-btn"),check:$('<i class="fa fa-check" aria-hidden="true"></i>'),stars:()=>$(".blog-rates > .stars .star"),average_stars:()=>$(".blog-rates > average-rate .stars .star")},request:{requestInit:{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")}},similar_blogs:async function(){let e=o.request.requestInit,t=window.location.origin+"/blogs/"+o.id+"/similar";return await fetch(t,e)},comment:async function(t,n){let s={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")},body:JSON.stringify({content:t,tagged:n})},i=window.location.origin+"/blogs/"+o.id+"/comments/create";return await fetch(i,s)},reply:async function(t,n){let s={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")},body:JSON.stringify({reply_content:t})},i=window.location.origin+"/blogs/"+o.id+"/comments/"+n+"/reply";return await fetch(i,s)},rate:async function(e){let t=window.location.origin+"/blogs/"+o.id+"/rate",n=o.request.requestInit;return n.body=JSON.stringify({stars_count:e}),await fetch(t,n)},get_rates:async function(){let e=window.location.origin+"/blogs/"+o.id+"/rates",t=o.request.requestInit;return await fetch(e,t)},get_user_rate:async function(){let e=window.location.origin+"/blogs/"+o.id+"/user_rate",t=o.request.requestInit;return await fetch(e,t)},save:async function(e){},get_comments:async function(t,n,o){let s={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")},body:JSON.stringify({count:n||1,start_with:o||1})},i=window.location.origin+"/blogs/"+t+"/comments";return await fetch(i,s)},get_replies:async function(t,n){let s={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")}},i=window.location.origin+"/blogs/"+o.id+"/comments/"+t+"/replies";return await fetch(i,s)},get_comment:async function(t){let n={method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json","X-CSRFTOKEN":e("csrftoken")}},s=window.location.origin+"/blogs/"+o.id+"/comments/"+t;return await fetch(s,n)},average_rate:async function(){let e=window.location.origin+"/blogs/"+o.id+"/rates/average",t=o.request.requestInit;return await fetch(e,t)},is_authenticated:async function(){let e=window.location.origin+"/is_authenticated/",t=o.request.requestInit;return await fetch(e,t)},blog_views:async function(){let e=window.location.origin+"/blogs/"+o.id+"/views",t=o.request.requestInit;return await fetch(e,t)}},eventHandlers:{getTag:function(e){let t=e.split(" "),n=[];for(let e of t){0===e.search("@")&&n.push(e.split("@")[1])}return n},resolveTags:function(e){let t=e,n=o.eventHandlers.getTag(e);t=t.replace("@","");for(let e of n){let n=window.origin+"/user/"+e;t=t.replace(e,`<a href="${n}" class="tagged">${e}</a>`)}return t},comment:async function(e){var t=await o.request.is_authenticated();if("success"===(await t.json()).message){let t=$(e.currentTarget);t.attr("disabled",!0);let n=o.elements.comment_input().val(),s=o.eventHandlers.getTag(n);console.log("tags = ",s);let i=await o.request.comment(n,s),a=await i.json();t.removeAttr("disabled"),o.elements.comment_input().val(""),t.html(o.elements.check),setTimeout(()=>{t.html('<i class="fa fa-paper-plane" aria-hidden="true"></i>')},1e3);let c=await o.request.get_comment(a.id),r=await c.json();r.isComment=!0,o.elements.comments_body().find(".more-comments").before(o.models.comment(r));let m=Number(o.models.comments_count.text());o.models.comments_count.text(m+1)}},show_comments:async function(e){let t=o.elements.comments_body(),n=await o.models.comment_loading(10);t.find(".more-comments").before(n);let s=await o.request.get_comments(o.id,10,e||[]),i=await s.json();if(0!=i.comments)for await(let e of i.comments){e.isComment=!0;let s=o.models.comment(e);t.find(".more-comments").before(s),n.remove()}else o.elements.comments_body().html(o.models.no_comments);$(".comments-container .list-comments .title h4 span ")[0].innerHTML=i.count},more_comments:async function(e){$(e);let t=o.elements.comments_body(),n=await o.models.comment_loading(6);t.find(".more-comments").before(n);let s=await o.request.get_comments(o.id,6,o.comments_list),i=await s.json();if(console.log(i.comments),0!=i.comments.length){for await(let e of i.comments){e.isComment=!0;let s=o.models.comment(e);t.find(".more-comments").before(s),n.remove()}console.log(o.comments_list)}else $(".more-comments").remove(),n.remove()},show_replies:async function(e){$(e.currentTarget);let t=await o.request.get_replies(e.comment_id,5),n=await t.json(),s=e.container.find(".comment_content > .options > .show-replies");for await(let t of n.comment_replies){let n=o.models.comment({id:t.reply_id,commented_by:t.replied_by,content:t.content,created_date:t.created_date});e.container.find(" > .comment_content").append(n)}s.text("Hide replies"),e.container.repliesShown=!0},reply:async function(e){$(e.currentTarget);let t=await o.request.reply(e.content,e._id),n=await t.json();console.log(n);o.models.comment({id:n.reply_id,commented_by:n.replied_by,content:n.content,created_date:n.created_date,isComment:!1,replies_count:n.replies_count});e.container.find(" .comment_content > .options > .show-replies").text("Show "+n.replies_count+" replies"),e.container.find(".comment-inputs").remove();let s=Number(o.models.comments_count.text());o.models.comments_count.text(s+1)},setStarsCount:function(e){o.elements.stars().removeClass("star-active");let t=$(e.currentTarget)[0];console.log(t);for(let e=t.classList[1]-1;e>=0;e--){o.elements.stars()[e].classList+=" star-active"}},_setStarsCount:function(e){if(console.log("count = ",e),0!==e){for(let t=$(".stars").find(".star."+e)[0].classList[1]-1;t>=0;t--){o.elements.stars()[t].classList+=" star-active"}}},setRatesCount:async function(){var e=await o.request.get_rates(),t=await e.json();console.log(t),$(".blog-rates .count span").text(t.count)},setAverageRate:async function(){let e=await o.request.average_rate(),t=await e.json(),n=Number(t.stars.toString().split(".")[0]);if(console.log("average count = ",n),0!==n){let e=$(".average-rate .stars").find(".star."+n)[0];console.log("Average target =",e);for(let t=e.classList[1]-1;t>=0;t--){$(".average-rate .stars")[0].children[t].classList+=" star-active"}}},similar_blogs:async function(){let e=await o.request.similar_blogs(),t=await e.json();console.log(t)},set_viewed:async function(){let e=window.location.origin+"/blogs/"+o.id+"/set_viewed",t=o.request.requestInit,n=await fetch(e,t);if(n.ok){let e=await n.json();console.log(e)}}},comments_list:[],init:async function(){var e=await o.request.get_user_rate(),t=await e.json();await o.eventHandlers.setRatesCount(),o.eventHandlers._setStarsCount(t.stars||0),o.elements.stars().on("mouseenter",o.eventHandlers.setStarsCount),o.elements.stars().on("mouseleave",async function(e){o.elements.stars().removeClass("star-active");var t=await o.request.get_user_rate(),n=await t.json();o.eventHandlers._setStarsCount(n.stars||0)}),o.elements.stars().on("click",async function(e){o.elements.stars().removeClass("star-active");let t=$(e.currentTarget)[0].classList[1];var n=await o.request.rate(t),s=await n.json();o.eventHandlers._setStarsCount(s.stars_count)}),o.models.more_comments().on("click",o.eventHandlers.show_comments),o.elements.comments_body().append(o.models.more_comments()),await o.eventHandlers.setAverageRate(),await o.eventHandlers.show_comments(),o.elements.comment_btn().on("click",o.eventHandlers.comment),await o.eventHandlers.similar_blogs(),setTimeout(async function(){await o.eventHandlers.set_viewed(),console.log("Blog Viewed !")},1)},refresh:async function(){o.elements.comments_body().html(""),await o.init()}};o.init()}();
